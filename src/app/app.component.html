<div class="min-h-screen flex flex-col bg-[#141414] overflow-hidden relative isoalte">
  <!-- AFFICHAGE / HERO BANNER - FIXE -->
<div class="absolute top-0 left-0 right-0 transition-all duration-500" [ngClass]="{
    'h-[50vh]': !selected() && !carouselFullscreen(),
    'h-screen': selected() || carouselFullscreen(),
    'z-0': !selected() && !carouselFullscreen(),
    'z-50': selected() || carouselFullscreen()
  }">
    
    <!-- Wrapper avec animation de fade -->
    <div class="w-full h-full transition-opacity duration-700 ease-in-out"
         [ngClass]="{'opacity-0': isTransitioning(), 'opacity-100': !isTransitioning()}">
      
      @if (activeRow() === 0 && activeIndex() >= 0 && activeIndex() < menages().length) {
        <app-affichage
          [data]="menages()[activeIndex()]" 
          [type]="'menage'"
          class="animate-fade-in">
        </app-affichage>
      } 
      @else if (activeRow() === 1 && activeIndex() >= 0 && activeIndex() < affiches().length) {
        <app-affichage
          [type]="'affiche'" 
          [data]="affiches()[activeIndex()]"
          class="animate-fade-in">
        </app-affichage>
      }
      @else if (activeRow() === 2 && activeIndex() >= 0 && activeIndex() < video().length) {
        <app-affichage
          [data]="video()[activeIndex()]" 
          [type]="'video'"
          class="animate-fade-in">
        </app-affichage>
      }
    </div>
    
    <!-- Gradient overlay -->
    @if (!selected() && !carouselFullscreen()) {
      <div class="absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-[#141414] to-transparent pointer-events-none">
      </div>
    }
    
    <!-- Indicateur de carrousel -->
    @if (carouselFullscreen()) {
      @if (hidden()) {
        <div class="absolute top-8 right-8 bg-black/80 px-6 py-3 rounded-full flex items-center gap-3">
          <div class="w-3 h-3 bg-red-600 rounded-full animate-pulse"></div>
          <span class="text-white font-semibold">Lecture automatique</span>
        </div>
      }
    }
</div>
  <!-- GRILLE DE RANGÉES -->
  @if (!selected() && !carouselFullscreen()) {
  <div class="absolute top-[50vh] left-0 right-0 bottom-0 overflow-hidden z-50 bg-[#141414]">
    <div class="absolute inset-x-0 z-0 ">
      <div class="space-y-12 pb-32 bg-[#141414]">

        <!-- RANGÉE 1 : MÉNAGES -->
        @if (menages().length > 0) {
        <div class="row-container px-12 py-8 bg-[#141414]" [class.row-focused]="activeRow() === 0">
          <h2 class="text-white font-bold mb-6" [class.text-4xl]="activeRow() === 0"
            [class.text-2xl]="activeRow() !== 0" [class.ml-4]="activeRow() === 0">
            Ménages
          </h2>

          <div class="relative">
            <!-- Overlay gauche -->
            <div
              class="absolute left-0 top-0 bottom-0 w-16 bg-linear-to-r from-[#141414] to-transparent z-10 pointer-events-none">
            </div>

            <!-- Overlay droite -->
            <div
              class="absolute right-0 top-0 bottom-0 w-16 bg-linear-to-l from-[#141414] to-transparent z-10 pointer-events-none">
            </div>

            <!-- Grille de cards avec bouton Play -->
            <div class="grid grid-cols-5 gap-3 px-2">

              <!-- Bouton Play en première position -->
              <app-card #card [tabIndex]="activeRow() === 0 && activeIndex() === -1 ? 0 : -1"
                [active]="activeRow() === 0 && activeIndex() === -1" [type]="'play'"
                (selected)="onPlayCardSelected(0)" />

              <!-- Cards normales -->
              @for (item of menages(); track $index) {
              <app-card #card [data]="item" [tabIndex]="activeRow() === 0 && activeIndex() === $index ? 0 : -1"
                [active]="activeRow() === 0 && activeIndex() === $index" (selected)="openPanel($event)" />
              }
            </div>
          </div>
        </div>
        }

        <!-- RANGÉE 2 : AFFICHES -->
        @if (affiches().length > 0) {
        <div class="px-12 py-8 bg-[#141414]" [class.row-focused]="activeRow() === 1"
          [class.row-dimmed]="activeRow() !== 1">
          <h2 class="text-white font-bold mb-6" [class.text-4xl]="activeRow() === 1"
            [class.text-2xl]="activeRow() !== 1" [class.ml-4]="activeRow() === 1">
            Affiches
          </h2>

          <div class="relative">
            <div
              class="absolute left-0 top-0 bottom-0 w-16 bg-linear-to-r from-[#141414] to-transparent z-10 pointer-events-none">
            </div>

            <div
              class="absolute right-0 top-0 bottom-0 w-16 bg-linear-to-l from-[#141414] to-transparent z-10 pointer-events-none">
            </div>

            <!-- Grille de cards avec bouton Play -->
            <div class="grid grid-cols-5 gap-3 px-2">

              <!-- Bouton Play en première position -->
              <app-card #card [tabIndex]="activeRow() === 1 && activeIndex() === -1 ? 0 : -1"
                [active]="activeRow() === 1 && activeIndex() === -1" [type]="'play'"
                (selected)="onPlayCardSelected(1)" />

              <!-- Cards normales -->
              @for (item of affiches(); track $index) {
              <app-card #card [data]="item" [tabIndex]="activeRow() === 1 && activeIndex() === $index ? 0 : -1"
                [active]="activeRow() === 1 && activeIndex() === $index" (selected)="openPanel($event)" />
              }
            </div>
          </div>
        </div>
        }
        @if (video().length > 0) {
        <div class="px-12 py-8 bg-[#141414]" [class.row-focused]="activeRow() === 2"
          [class.row-dimmed]="activeRow() !== 2">

          <h2 class="text-white font-bold mb-6" [class.text-4xl]="activeRow() === 2"
            [class.text-2xl]="activeRow() !== 2" [class.ml-4]="activeRow() === 2">
            Video
          </h2>

          <div class="relative">
            <div
              class="absolute left-0 top-0 bottom-0 w-16 bg-linear-to-r from-[#141414] to-transparent z-10 pointer-events-none">
            </div>
            <div
              class="absolute right-0 top-0 bottom-0 w-16 bg-linear-to-l from-[#141414] to-transparent z-10 pointer-events-none">
            </div>

            <div class="grid grid-cols-5 gap-3 px-2">
              <app-card #card [tabIndex]="activeRow() === 2 && activeIndex() === -1 ? 0 : -1"
                [active]="activeRow() === 2 && activeIndex() === -1" [type]="'play'"
                (selected)="onPlayCardSelected(2)" />

              @for (item of video(); track $index) {
              <app-card [type]="'video'" #card [data]="item"
                [tabIndex]="activeRow() === 2 && activeIndex() === $index ? 0 : -1"
                [active]="activeRow() === 2 && activeIndex() === $index" (selected)="openPanel($event)" />
              }
            </div>
          </div>
        </div>
        }

      </div>
    </div>
  </div>
  }
</div>